---
title: "Juvenile snowshoe hares in Bonanza Creek Experimental Forest: exploritory report "
author: "Author: Sage Davis"
date: "11/7/2021"
output: html_document
---


```{r setup, include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE,message = FALSE, warning = FALSE)
 
library(tidyverse)
library(janitor)
library(here)
library(lubridate)
library(kableExtra)
library(effsize)
library(ggbeeswarm)

```

```{r include = FALSE, message = FALSE, warning = FALSE}
# Read in hare bonanza data

hares <- read_csv(here("data", "bonanza_hares.csv"))

hares
```

## 1. Introduction

This report provides an exploratory overview if differences in juvenile hares for three Bonanza Creek Experimental Forest (Long Term Research Forest) sampling sites (Bonanza Black Spruce, Bonanza Mature, Bonanza Riparian) in Alaska during the interval between 1998 - 2012 (Kielland et al. 2017). These sites were used for live trappings of snowshoe hares to monitor their abundance and survival in the experimental forest.  Specifically the number of juvenile hares trapped each year, the hare weights compared  by sex and sampling location, the compared weights between each sex, and the relationship between weight and hind foot length.

## 2. Data & Analysis

Hare data including sampling site, date caught, sex, age (adult or juvenile), left ear, right ear, hind foot length, and weight was collected and provided by Dr. Knut Kielland and his colleagues at the Bonanza Creek Experimental Forest in Alaska.  The data contained 3197 unique observations of hares, and of those those there were 378 juvenile hare observations, collected over 14 years.  Following exploratory data analysis and visualizations, the juvenile weight comparisons between male and female are compared using a two-sample t-test.  They are further compared using a Cohen's d effect size.  The relationship between the juvenile weight and hind foot length is explored using a linear regression.  All analyses are in R version 4.1.1 using RStudio version 2021.09.0.


## Prelimary Results

### A. Annual juvenile hare counts

```{r echo = FALSE, message = FALSE, warning = FALSE, fig.keep = "last", fig.align = "center"}

# 3) c) i) i)	Annual juvenile hare trap counts. Count the total number of juvenile hare trappings during each year of the study, and create a finalized data visualization of the counts by year. Include a figure caption below the figure in your report. 

# Convert date to date format, add column for day and year

hares_date <- hares %>%        
  mutate(date = mdy(date)) %>%    
  mutate(day = day(date)) %>%     
  mutate(year = year(date))       

# Count annual hare traps, filter for juveniles
  
hares_juv <- hares_date %>%    
  filter(age == "j")        

# Create Table Summarize by year

hares_juv_count <- hares_juv %>% 
  group_by(year) %>% 
  summarize(juv_count = n())  
            
# pull max, min, median, mean from hares_juv_counts

hares_min <- min(hares_juv_count$juv_count, na.rm = TRUE)

hares_max <- max(hares_juv_count$juv_count, na.re = TRUE)

hares_mean <- mean(hares_juv_count$juv_count, na.rm = TRUE)

hares_med <- median(hares_juv_count$juv_count, na.rm = TRUE)


# Create finalized data visualization for year vs. count

ggplot(data = hares_juv_count, aes(x = year, y = juv_count)) +
  geom_col(fill = "yellow", color = "blue") + 
  theme_minimal() +
  labs(x = "Year", y = "Annual Juvenile Hare Trappings")

ggplot(data = hares_juv_count, aes(x = year, y = juv_count)) +
  geom_line(fill = "yellow", color = "blue") + 
  geom_point(shape = 21, color = "black", fill = "red", size = 3) +
  theme_minimal() +
  labs(x = "Year", y = "Annual Juvenile Hare Trappings") +
  scale_x_continuous(breaks = scales::breaks_width(2))
  

```

**Figure 1.**  Annual juvenile hare observations during 1998 - 2012 at Bonanza Creek LTER, Alaska.  Kielland, et al. (2017).  

The juvenile hare observation (trapped) stats were `r hares_max` max., `r hares_min` min., `r hares_med` median, and `r hares_mean` mean.  The overall observations are trending down for the data set but this could be due to some other factor like trap failure or location.  It appears that the trappings are cycling every two to three years from about 50 to under 10 catches annually.  This could possibly be due to the weather or time of year that there traps are deployed. 


### B. Juvenile hare weights for each sex at each sampling sites


```{r echo = FALSE, message = FALSE, warning = FALSE, fig.keep = "last", fig.align = "center"}

# 3) c) ii) ii)	Visualize juvenile hare weights. Create a finalized data visualization (or visualizations) in which you compare **juvenile hare weights by sex and site (grid)** (ignore other variables). You should include groups where these variables are not recorded (`NA`). Include finalized figure captions below your visualization(s).

hares_juv_sex_case <- hares_juv %>%   # Change sex labels
  mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male"))
  
# Plot points sex vs. weight by sampling site

ggplot(data = hares_juv_sex_case, aes(x = sex, y = weight, color = grid)) +   
  geom_beeswarm() +
  theme_minimal() +
  facet_wrap(~grid) +                
  theme(strip.text.x = element_blank()) +
  labs(x = "Sex", y = "Weight (g)", 
       legend.title = "Sampling Site") +
  scale_color_discrete(name = "Sampling Site",
                       labels = c("Bonanza Black Spruce", "Bonanza Mature", "Bonanza Riparian"))  # rename legend

```

**Figure 2.**  Plots of the juvenile hare weights (grams) vs sex for the Female, Male , and Unidentifiable juvenile hares at the three sampling sites during 1998 - 2012 at Bonanza Creek LTER, Alaska.  Kielland, et al. (2017).  

The Bonanza Riparian site appears to have the largest number of trappings while the Bonanza Black Spruce appears to have the smallest.  Overall, the range of weights is between 400 to 1500 grams.  Both the sexes appear to be in the same relative weight range at all three sites.


### C. Female and male juvenile hare weight comparison

```{r echo = FALSE, message = FALSE, warning = FALSE, fig.keep = 'none', results = FALSE}

# 3) c) iii)	Juvenile weight comparison (male & female snowshoe hares). Further compare mean weights for **juvenile male and female snowshoe hares** included in this study. In this section, you should include:

# ‚óè	A finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares, with a table caption (remember, a table caption should be placed *above* the table in your report)

# Start with hares_juvsex_case dataset & remove sex with NA in cell

hares_juv_sex <- hares_juv_sex_case %>%   
  filter(!is.na(sex))           

# Start with hares_juv_sex dataset, create table by sex for various weight stats, round data 

hares_juv_weights <- hares_juv_sex %>%   
  group_by(sex) %>% 
  summarize(wt_mean = round(mean(weight, na.rm = TRUE), 1),  
           wt_sd = round(sd(weight, na.rm = TRUE), 1),      
           sample_size = n())

# Exploratory Code and Plots

# Plot points sex vs. weight

ggplot(data = hares_juv_sex, aes(x = weight, color = sex)) +   
  geom_histogram() +
  facet_wrap(~grid)

ggplot(data = hares_juv_sex, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~grid)

# Previous Plot - Histogram does not really look normally distributed but QQ-plot looks ok

# Plot points sex vs. weight

ggplot(data = hares_juv_sex, aes(x = weight, color = grid)) +   
  geom_histogram(binwidth = 20) +
  facet_wrap(~sex)

ggplot(data = hares_juv_sex, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)

# Previous plot - Female looks more normally distributed



# Perform Cohen D

weight_cohen <- cohen.d(weight ~ sex, hares_juv_sex, na.rm = TRUE)

# Split into male and female datasets 

hares_juv_f <- hares_juv_sex %>% 
  filter(sex == "Female") %>% 
  select(weight)

hares_juv_m <- hares_juv_sex %>% 
  filter(sex == "Male") %>% 
  select(weight)

# Perform t-test

hares_juv_wt_sex_t <- t.test(hares_juv_m, hares_juv_f)

round(hares_juv_wt_sex_t$estimate, 2)

```



```{r echo = FALSE, message = FALSE, warning = FALSE}

 # 3) c) iii) Table finalized

# Finalize Table

hares_juv_weights_table <- hares_juv_weights %>%                    
  kable(col.names = c("Hare Sex",
                      "Mean Weight (g)", 
                      "Standard Deviation (g)",
                      "Sample Size (n)"), 
        caption = "Female & Male Juvenile Hare Weight Means, Standard Deviations & Sampling Size") %>% 
  kable_styling(full_width = FALSE)

hares_juv_weights_table

```
  
The distributions of the female and male hares is relatively similar but the female distribution is more normal according to the qq-plot analysis.  The male hares were heaviest of the two (`r hares_juv_weights[2,2]` $\pm$ `r hares_juv_weights[2,3]` g, *n* = `r hares_juv_weights[2,4]`; mean $\pm$  1 standard deviation), compared to female hares (`r hares_juv_weights[1,2]` $\pm$ `r hares_juv_weights[1,3]` g, *n* = `r hares_juv_weights[1,4]`; mean $\pm$  1 standard deviation).  The Cohen's effect size of `r round(weight_cohen$estimate, 2)` is small. The Welch two-sample t-test provided a t value of `r round(hares_juv_wt_sex_t$statistic, 3)`, a p-value of `r round(hares_juv_wt_sex_t$p.value, 3)`, and the difference in the means of 90.5g (or 10%).
   
### D. Relationship between juvenile hare weight and hind foot length  
  
```{r echo = FALSE, message = FALSE, warning = FALSE, fig.keep = 'all'}

# 3) c) iv) Relationship between juvenile weight & hind foot length. Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

# hares_juv_wt_hr <- hares_juv  %>%  # start with hares_juv data

ggplot(data = hares_juv, aes(x = hindft, y = weight, color = sex)) +
  geom_point() +
  geom_smooth(method = "lm",color = "purple", size = 0.7, fill = "gray10", alpha = 0.3) +
  theme_minimal() +
  labs(x = "Hindfoot Length (mm)", y = "Hare Weight (g)") +
  scale_color_discrete(name = "Sex",          # formulas say _fill_?
                      labels = c("Female", "Male", "Undetermined")) +
  theme(legend.position = c(0.15, 0.7))

```

**Figure 3.**  Linear regression plot of the relationship between the juvenile hare weight(g) vs the hind foot length(mm) during 1998 - 2012 at Bonanza Creek LTER, Alaska. The sample data is color coded for hare sex (Female = pink, Male = blue, Undermined = gray).  Kielland, et al. (2017)



```{r echo = FALSE, message = FALSE, warning = FALSE, fig.keep = 'none', results = FALSE}

# Boss asks for linear regression of Weight vs Hind foot Length

hares_juv_lm <- lm(weight ~ hindft, data = hares_juv)

summary(hares_juv_lm)

hares_juv_lm_glance <- broom::glance(hares_juv_lm)

plot(hares_juv_lm)

# Pearson's test

pear <- cor.test(hares_juv$hindft, hares_juv$weight, method = "pearson")

pear

```

The linear regression showed that on average the weight of the hare will increase by `r round(hares_juv_lm$coefficient[2], 2)` grams per mm of hind foot increase.  It showed that the (weight) slope intercept is `r round(hares_juv_lm$coefficient[1], 2)` which seems meaningless since the weight cannot be negative but just reflects that the model is only applicable in meaningful range. The model outputs an adjusted R-squared value of `r round(hares_juv_lm_glance$adj.r.squared, 1)`.

## Summary
The exploratory data analysis yielded the following initial findings:

- The Bonanza  Riparian sampling site captures the most juvenile hares.
- The male juvenile hares had a higher mean body mass(the difference was not insignificant and the effect size was small).
- Hare body mass appears to be linearly related to hind foot length.  This significant relationship was established by linear regression, resulting in a slope (expected average gram increase in weight with a 1 mm increase in hind foot length) is `r round(hares_juv_lm$coefficient[2], 2)` g/mm.

Next Steps:

- Compare adult weights to hind foot lengths, and perform linear regression.
- Compare above adult linear regression to juvenile linear regression.
- Compare linear above at each sampling site.



## Citations
(Kielland), K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14
